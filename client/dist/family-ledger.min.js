angular.module("ledger",["ledger.auth","ngRoute"]).config(function(a){a.when("/",{templateUrl:"app/views/signin.ejs",controller:"AuthController"}).when("/signin",{templateUrl:"app/views/signin.ejs",controller:"AuthController"}).when("/signup",{templateUrl:"app/views/signup.ejs",controller:"AuthController"})}),angular.module("ledger.auth",[]).constant("API","104.131.145.63:8000").config(function(a){a.interceptors.push("authInterceptor")}).controller("AuthController",function(a,b){var c=this;c.isAuthed=b.isAuthed,c.logout=b.logout;var d=function(a){a.data?a.data.token:null;c.message=a.data.message};c.login=function(){a.login(c.username,c.password).then(d,d)},c.register=function(){a.register(c.username,c.password).then(d,d)},c.profile=function(){a.profile().then(d,d)},c.logout=function(){b.logout&&b.logout()},c.isAuthed=function(){return b.isAuthed?b.isAuthed():!1}}).factory("authInterceptor",function(a,b){return{request:function(c){var d=b.getToken();return 0===c.url.indexOf(a)&&d&&(c.headers.Authorization="Bearer "+d),c},response:function(c){return 0===c.config.url.indexOf(a)&&c.data.token&&b.saveToken(c.data.token),c},responseError:function(b){return 401===b.status&&($window.location.href=a),b}}}).service("user",function(a,b,c){var d=this;d.profile=function(){return a.get(b+"/profile")},d.register=function(c,d){return a.post(b+"/users",{username:c,password:d})},d.login=function(c,d){return a.post(b+"/users",{username:c,password:d})}}).service("auth",function(a){var b=this;b.parseJwt=function(b){var c=b.split(".")[1],d=c.replace("-","+").replace("_","/");return JSON.parse(a.atob(d))},b.saveToken=function(b){a.localStorage.jwtToken=b},b.getToken=function(){return a.localStorage.jwtToken},b.isAuthed=function(){var a=b.getToken();if(a){var c=b.parseJwt(a);return Math.round((new Date).getTime()/1e3)<=c.exp}return!1},b.logout=function(){a.localStorage.removeItem("jwtToken")}});